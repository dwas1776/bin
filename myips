#!/bin/bash
###################################################
#
# FILENAME:   myip
# PURPOSE:    For Mac OS X, this will print the 
#             time, private IP, and public IP
#             
#             If you provide no options, it will
#             produce these values once and then exit.
#
#             The "-i" option, followed with an integer
#             will produce a continuous loop with an
#             interval equal to the integer argument you
#             provide.  Example: myips -i 30
#
# REVISIONS:
#
###################################################

usage() {
    echo "Usage: "
    echo "     no options will display the time, private IP,"
    echo "     public IP and then exit."
    echo ""
    echo "     -i followed by an integer will loop by that interval."
    echo ""
    exit 0
        }

while getopts ":i:" opt; do
    case $opt in 
        i)  INTERVAL="${OPTARG}"
            ;;
        *)  usage
            ;;
    esac
done
shift $(($OPTIND - 1))

if [ -n "${INTERVAL}" ]; then
  clear
else
  PubIP=$(dig +short myip.opendns.com @resolver1.opendns.com)
  PriIP=$(ipconfig getifaddr en0)
  TIME=$(date "+%T")
  printf "Time:\t\t${TIME}\nPrivate IP:\t${PriIP}\nPublic IP:\t${PubIP}\n"
  exit 0
fi

while :;do
  printf "\n   Time\t\t Private IP\t Public IP\n"
  printf "  ===============================================\n"
  COUNTER=0
  while [ $COUNTER -lt 24 ]; do
      PubIP=$(dig +short myip.opendns.com @resolver1.opendns.com)
      #PriIP=$(ipconfig getifaddr en0)
      PriIP=$(ipconfig getifaddr $(netstat -nr | awk '{ if ($1 ~/default/) { print $6} }'))
      TIME=$(date "+%T")
    printf "  $TIME\t$PriIP\t$PubIP\n"
    let COUNTER=COUNTER+1
    sleep $INTERVAL
  done
done
